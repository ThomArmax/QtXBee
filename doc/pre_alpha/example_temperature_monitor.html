<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.3.1"/>
        <script type="text/javascript" src="jquery-2.1.1.min.js"></script>
        <title>QtXBee: Temperature monitor using QtXBee and Arduino</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
        <link href="customdoxygen.css" rel="stylesheet" type="text/css" />
        <link href="bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <script src="bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">QtXBee 0.1.pre-alpha</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="examples.html">Examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Temperature monitor using <a class="el" href="namespace_qt_x_bee.html" title="Namespace common to XBee Serie1 (802.15.4) and Serie2 (ZigBee)">QtXBee</a> and Arduino </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example shows how to create a simple temperature monitor, using one computeur and one Arduino.</p>
<div class="image">
<img src="xbee_temp_sensor.png" alt="xbee_temp_sensor.png"/>
</div>
<p>In this very simple case, the monitor (computer) will send each second a <a class="el" href="class_qt_x_bee_1_1_wpan_1_1_tx_request16.html" title="The TxRequest16 class is used to send a message over 802.15.4 network using 16 bits addresses...">QtXBee::Wpan::TxRequest16</a> with data 'temp' to query the temperature. On each reception of this frame, the temperature sensor node will send back a <a class="el" href="class_qt_x_bee_1_1_wpan_1_1_rx_response16.html" title="The RxResponse16 class represents the reponse to a TxRequest16.">QtXBee::Wpan::RxResponse16</a> and its data field will represent the temperature. On each reception of a <a class="el" href="class_qt_x_bee_1_1_wpan_1_1_rx_response16.html" title="The RxResponse16 class represents the reponse to a TxRequest16.">QtXBee::Wpan::RxResponse16</a>, the monitor will emit the temperatureReceived(float temperature) signal, which will update the UI.</p>
<hr/>
<h1><a class="anchor" id="example_temperature_monitor_summary"></a>
Summary</h1>
<ul>
<li><a class="el" href="example_temperature_monitor.html#example_temperature_monitor_recipe">Recipe</a></li>
<li><a class="el" href="example_temperature_monitor.html#example_temperature_monitor_elec">Electronic part</a><ul>
<li><a class="el" href="example_temperature_monitor.html#example_temperature_monitor_elec_onewire">1-Wire bus</a></li>
<li><a class="el" href="example_temperature_monitor.html#example_temperature_monitor_elec_xbee_shield_hack">XBee shield hack</a></li>
<li><a class="el" href="example_temperature_monitor.html#example_temperature_monitor_elec_final">Final result:</a></li>
</ul>
</li>
<li><a class="el" href="example_temperature_monitor.html#example_temperature_monitor_xbee_config">XBee modules configuration</a></li>
<li><a class="el" href="example_temperature_monitor.html#example_temperature_monitor_code">Code</a></li>
</ul>
<hr/>
<h1><a class="anchor" id="example_temperature_monitor_recipe"></a>
Recipe</h1>
<p>For this example, I used:</p>
<ul>
<li>a <a href="http://www.matlog.fr/fr/106-cartes-interfaces-pour-modules-xbee.html#/digi_cartes_interfaces-xbee_int_usb">XBee explorer</a> (which will be connected to the computer)</li>
<li>2 <a href="http://www.matlog.fr/fr/57-modules-xbee-802154-serie-1.html">XBee Serie 1</a> modules</li>
<li>one <a href="http://www.matlog.fr/fr/179-cartes-controleurs-arduino.html#/arduino_contrleurs-arduino_uno">Arduino Uno</a></li>
<li>one <a href="http://www.matlog.fr/fr/181-shields-radio-arduino.html">XBee shield</a></li>
<li><a href="https://github.com/jwintz/qchart.js">QChart.js</a> (QML binding for Chart.js)</li>
<li><a href="https://github.com/andrewrapp/xbee-arduino">xbee-arduino</a> library (XBee library for Arduino)</li>
<li><a href="http://www.pjrc.com/teensy/td_libs_OneWire.html">OneWire</a> arduino library (1-Wire library for Arduino)</li>
<li>a 4.7 kΩ resistor</li>
<li>a <a href="http://www.maximintegrated.com/en/products/analog/sensors-and-sensor-interface/DS18S20.html">DS18S20</a> (One wire digital temperature sensor)</li>
<li>some wires</li>
<li>a breadboard</li>
</ul>
<h1><a class="anchor" id="example_temperature_monitor_elec"></a>
Electronic part</h1>
<h2><a class="anchor" id="example_temperature_monitor_elec_onewire"></a>
1-Wire bus</h2>
<p>[Wikipedia] 1-Wire is a device communications bus system designed by Dallas Semiconductor Corp. that provides low-speed data, signaling, and power over a single signal. 1-Wire is similar in concept to I²C, but with lower data rates and longer range. It is typically used to communicate with small inexpensive devices such as digital thermometers and weather instruments. A network of 1-Wire devices with an associated master device is called a MicroLAN.</p>
<p>This scheme shows how to wire 1-Wire devices: </p>
<div class="image">
<img src="onewire-3fils.png" alt="onewire-3fils.png"/>
</div>
<p>Here is the scheme I used to plug the DS18S20 to my arduino: </p>
<div class="image">
<img src="DS18S20-hookup.png" alt="DS18S20-hookup.png"/>
</div>
<h2><a class="anchor" id="example_temperature_monitor_elec_xbee_shield_hack"></a>
XBee shield hack</h2>
<p>Because I only have one Arduino shield (<a href="http://www.matlog.fr/fr/181-shields-radio-arduino.html">XBee shield</a>) on which I don't have access to power pins (5V, GND), I had to 'hack' it by soldering a header on the shield: </p>
<div class="image">
<img src="xbee_shield_hack.jpg" alt="xbee_shield_hack.jpg"/>
</div>
<h2><a class="anchor" id="example_temperature_monitor_elec_final"></a>
Final result:</h2>
<div class="image">
<img src="xbee_temp_sensore_arduino.jpg" alt="xbee_temp_sensore_arduino.jpg"/>
</div>
<h1><a class="anchor" id="example_temperature_monitor_xbee_config"></a>
XBee modules configuration</h1>
<p>The temperature monitor node, will be the Coordinator, plugged to the computer. The temperature sensor node will be a End Device, plugged to the Arduino.</p>
<p>To be sure the modules will be able to comminicate, we should check their configurations:</p>
<table class="doxtable">
<tr>
<th>Parameter </th><th>Coordinator </th><th>Sensor </th><th>Description </th></tr>
<tr>
<td>MY </td><td>0 </td><td>2 </td><td>Node addr (16bits) </td></tr>
<tr>
<td>ID </td><td>3332 </td><td>3332 </td><td>Pan Id </td></tr>
<tr>
<td>AP </td><td>1 </td><td>1 </td><td>API mode </td></tr>
</table>
<h1><a class="anchor" id="example_temperature_monitor_code"></a>
Code</h1>
<h2><a class="anchor" id="example_temperature_monitor_code_maincpp"></a>
main.cpp</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;QGuiApplication&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QQmlApplicationEngine&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QQmlContext&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;tempmonitor.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    QGuiApplication app(argc, argv);</div>
<div class="line">    QQmlApplicationEngine engine;</div>
<div class="line">    TempMonitor monitor(<span class="stringliteral">&quot;/dev/ttyUSB0&quot;</span>);</div>
<div class="line"></div>
<div class="line">    monitor.setTempSensorAddress(2);</div>
<div class="line">    monitor.start(1000);</div>
<div class="line"></div>
<div class="line">    engine.rootContext()-&gt;setContextProperty(<span class="stringliteral">&quot;monitor&quot;</span>, &amp;monitor);</div>
<div class="line">    engine.load(QUrl(QStringLiteral(<span class="stringliteral">&quot;qrc:/main.qml&quot;</span>)));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> app.exec();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="example_temperature_monitor_code_tempmonitorh"></a>
tempmonitor.h</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef TEMPMONITOR_H</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TEMPMONITOR_H</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;QObject&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QTimer&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>QtXBee {</div>
<div class="line"><span class="keyword">class </span>XBee;</div>
<div class="line"><span class="keyword">namespace </span>Wpan {</div>
<div class="line"><span class="keyword">class </span>RxResponse16;</div>
<div class="line">}</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>TempMonitor : <span class="keyword">public</span> QObject</div>
<div class="line">{</div>
<div class="line">    Q_OBJECT</div>
<div class="line">    Q_PROPERTY(<span class="keywordtype">float</span> currentTemperature READ currentTemperature NOTIFY currentTemperatureChanged)</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">explicit</span> TempMonitor(<span class="keyword">const</span> QString &amp; serialPort, QObject * parent = 0);</div>
<div class="line">    ~TempMonitor();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">void</span> setTempSensorAddress(<span class="keyword">const</span> quint16 address);</div>
<div class="line">    <span class="keywordtype">float</span> currentTemperature() <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line">signals:</div>
<div class="line">    <span class="keywordtype">void</span> temperatureReceived(<span class="keywordtype">float</span> temperature);</div>
<div class="line">    <span class="keywordtype">void</span> currentTemperatureChanged();</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span> slots:</div>
<div class="line">    <span class="keywordtype">void</span> start(<span class="keyword">const</span> uint pollingTime = 1000);</div>
<div class="line">    <span class="keywordtype">void</span> stop();</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span> slots:</div>
<div class="line">    <span class="keywordtype">void</span> timerTriggered();</div>
<div class="line">    <span class="keywordtype">void</span> onPacketReceived(<a class="code" href="class_qt_x_bee_1_1_wpan_1_1_rx_response16.html" title="The RxResponse16 class represents the reponse to a TxRequest16.">QtXBee::Wpan::RxResponse16</a>*);</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <a class="code" href="class_qt_x_bee_1_1_x_bee.html" title="The XBee class is used to represents the local XBee.">QtXBee::XBee</a> *m_xbee;</div>
<div class="line">    quint16 m_sensorAddr;</div>
<div class="line">    QTimer m_pollingTimer;</div>
<div class="line">    <span class="keywordtype">float</span> m_currentTemp;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif // TEMPMONITOR_H</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example_temperature_monitor_code_tempmonitorcpp"></a>
tempmonitor.cpp</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;tempmonitor.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;XBee&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;wpan/TxRequest16&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;wpan/RxResponse16&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;wpan/TxStatusResponse&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;XBeeResponse&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;QDebug&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">union </span>{</div>
<div class="line">    <span class="keywordtype">float</span> value;</div>
<div class="line">    u_int8_t bytes[4];</div>
<div class="line">} float_sensor_result;</div>
<div class="line"></div>
<div class="line">TempMonitor::TempMonitor(<span class="keyword">const</span> QString &amp; serialPort, QObject *parent) :</div>
<div class="line">    QObject(parent),</div>
<div class="line">    m_xbee(NULL),</div>
<div class="line">    m_sensorAddr(0xFFFF),</div>
<div class="line">    m_currentTemp(0.0)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> xbee_success = <span class="keyword">false</span>;</div>
<div class="line">    m_xbee = <span class="keyword">new</span> <a class="code" href="class_qt_x_bee_1_1_x_bee.html" title="The XBee class is used to represents the local XBee.">QtXBee::XBee</a>(<span class="keyword">this</span>);</div>
<div class="line">    xbee_success = m_xbee-&gt;setSerialPort(serialPort);</div>
<div class="line">    Q_ASSERT(xbee_success);</div>
<div class="line">    xbee_success = m_xbee-&gt;open();</div>
<div class="line">    Q_ASSERT(xbee_success);</div>
<div class="line"></div>
<div class="line">    connect(&amp;m_pollingTimer, SIGNAL(timeout()),</div>
<div class="line">            <span class="keyword">this</span>, SLOT(timerTriggered()));</div>
<div class="line">    connect(m_xbee, SIGNAL(receivedRxResponse16(<a class="code" href="class_qt_x_bee_1_1_wpan_1_1_rx_response16.html" title="The RxResponse16 class represents the reponse to a TxRequest16.">QtXBee::Wpan::RxResponse16</a>*)),</div>
<div class="line">            <span class="keyword">this</span>, SLOT(onPacketReceived(<a class="code" href="class_qt_x_bee_1_1_wpan_1_1_rx_response16.html" title="The RxResponse16 class represents the reponse to a TxRequest16.">QtXBee::Wpan::RxResponse16</a>*)));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">TempMonitor::~TempMonitor()</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">float</span> TempMonitor::currentTemperature()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">return</span> m_currentTemp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> TempMonitor::setTempSensorAddress(<span class="keyword">const</span> quint16 address)</div>
<div class="line">{</div>
<div class="line">    m_sensorAddr = address;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> TempMonitor::start(<span class="keyword">const</span> uint pollingTime)</div>
<div class="line">{</div>
<div class="line">    m_pollingTimer.start(pollingTime);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> TempMonitor::stop()</div>
<div class="line">{</div>
<div class="line">    m_pollingTimer.stop();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> TempMonitor::timerTriggered()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="class_qt_x_bee_1_1_wpan_1_1_tx_request16.html" title="The TxRequest16 class is used to send a message over 802.15.4 network using 16 bits addresses...">QtXBee::Wpan::TxRequest16</a> req;</div>
<div class="line">    req.<a class="code" href="class_qt_x_bee_1_1_wpan_1_1_tx_request16.html#acf5e87df820bb8d2b41002a7d60ec8d8" title="Sets the 16 bits packet&#39;s destination address.">setDestinationAddress</a>(m_sensorAddr);</div>
<div class="line">    req.<a class="code" href="class_qt_x_bee_1_1_wpan_1_1_tx_request16.html#a1816a260962cd8afb5733530619d880a" title="Sets the data to be sent (Up to 100 bytes per packet)">setData</a>(<span class="stringliteral">&quot;temp&quot;</span>);</div>
<div class="line"></div>
<div class="line">    m_xbee-&gt;sendAsync(&amp;req);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> TempMonitor::onPacketReceived(<a class="code" href="class_qt_x_bee_1_1_wpan_1_1_rx_response16.html" title="The RxResponse16 class represents the reponse to a TxRequest16.">QtXBee::Wpan::RxResponse16</a> * packet)</div>
<div class="line">{</div>
<div class="line">    QByteArray data;</div>
<div class="line">    float_sensor_result result;</div>
<div class="line">    <span class="keywordtype">float</span> temperature;</div>
<div class="line"></div>
<div class="line">    data = packet-&gt;<a class="code" href="class_qt_x_bee_1_1_x_bee_response.html#ad0b03b35f45eace6253ac987416c1087" title="Returns the response&#39;s data.">data</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(data.size() == 4) {</div>
<div class="line">        memcpy(&amp;result.bytes, data.data(), 4);</div>
<div class="line"></div>
<div class="line">        temperature = result.value;</div>
<div class="line">        qDebug(<span class="stringliteral">&quot;Temp: %f°C&quot;</span>, temperature);</div>
<div class="line"></div>
<div class="line">        m_currentTemp = temperature;</div>
<div class="line"></div>
<div class="line">        emit temperatureReceived(temperature);</div>
<div class="line">        emit currentTemperatureChanged();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;Invalid packet received&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="example_temperature_monitor_code_mainqml"></a>
main.qml</h2>
<div class="fragment"><div class="line"><span class="keyword">import</span> QtQuick 2.4</div>
<div class="line">import QtQuick.Window 2.2</div>
<div class="line"></div>
<div class="line">import <span class="stringliteral">&quot;qchartjs&quot;</span></div>
<div class="line"><span class="keyword">import</span> <span class="stringliteral">&quot;qchartjs/QChart.js&quot;</span> as Charts</div>
<div class="line"><span class="keyword">import</span> <span class="stringliteral">&quot;monitor.js&quot;</span> as Monitor</div>
<div class="line"></div>
<div class="line">Window {</div>
<div class="line">    visible : <span class="keyword">true</span></div>
<div class="line">    width   : 800</div>
<div class="line">    height  : 480</div>
<div class="line">    Column {</div>
<div class="line">        anchors.fill    : parent</div>
<div class="line">        spacing         : 20</div>
<div class="line">        anchors.margins : 20</div>
<div class="line">        Text {</div>
<div class="line">            <span class="keywordtype">id</span>                  : title</div>
<div class="line">            width               : parent.width</div>
<div class="line">            text                : <span class="stringliteral">&quot;Current temperature : &quot;</span> + parseFloat(monitor.currentTemperature).toFixed(1) + <span class="stringliteral">&quot;°C&quot;</span></div>
<div class="line">            color               : <span class="stringliteral">&quot;#DCDCDC&quot;</span></div>
<div class="line">            horizontalAlignment : Text.AlignHCenter</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        QChart {</div>
<div class="line">            <span class="keywordtype">id</span>                      : tempChart</div>
<div class="line">            width                   : parent.width</div>
<div class="line">            height                  : parent.height - title.height - parent.spacing</div>
<div class="line">            chartAnimated           : <span class="keyword">true</span></div>
<div class="line">            chartAnimationEasing    : Easing.InOutElastic</div>
<div class="line">            chartAnimationDuration  : 2000</div>
<div class="line">            chartData               : Monitor.MonitorData</div>
<div class="line">            chartType               : Charts.ChartType.LINE</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    Connections {</div>
<div class="line">        target                  : monitor</div>
<div class="line">        onTemperatureReceived   : {</div>
<div class="line">            Monitor.appendData(parseFloat(temperature).toFixed(1));</div>
<div class="line">            tempChart.requestPaint();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="example_temperature_monitor_code_monitorjs"></a>
monitor.js</h2>
<div class="fragment"><div class="line">var MonitorData = {</div>
<div class="line">    labels: [<span class="comment">/*&quot;Temperature (°C)&quot;*/</span>],</div>
<div class="line">    datasets: [</div>
<div class="line">        {</div>
<div class="line">            fillColor: <span class="stringliteral">&quot;rgba(220,220,220,0.5)&quot;</span>,</div>
<div class="line">            strokeColor: <span class="stringliteral">&quot;rgba(220,220,220,1)&quot;</span>,</div>
<div class="line">            pointColor: <span class="stringliteral">&quot;rgba(220,220,220,1)&quot;</span>,</div>
<div class="line">            pointStrokeColor: <span class="stringliteral">&quot;#ffffff&quot;</span>,</div>
<div class="line">            data: []</div>
<div class="line">        }</div>
<div class="line">    ]</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">var MaxElements = 20;</div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> appendData(data) {</div>
<div class="line">    <span class="keywordflow">if</span>(MonitorData.datasets[0].data.length &gt;= MaxElements) {</div>
<div class="line">        MonitorData.datasets[0].data.splice(0, 1);</div>
<div class="line">        MonitorData.labels.splice(0, 1);</div>
<div class="line">    }</div>
<div class="line">    MonitorData.datasets[0].data.push(data);</div>
<div class="line">    MonitorData.labels.push(Qt.formatDateTime(<span class="keyword">new</span> Date(), <span class="stringliteral">&quot;hh:mm:ss&quot;</span>));</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="example_temperature_monitor_code_arduino"></a>
Arduino's code</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;XBee.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;OneWire.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define PAYLOAD_SIZE sizeof(float)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">union </span>{</div>
<div class="line">    <span class="keywordtype">float</span> float_variable;</div>
<div class="line">    uint8_t bytes_array[4];</div>
<div class="line">} float_sensor_result;</div>
<div class="line"></div>
<div class="line">uint8_t *data                   = NULL; <span class="comment">// received data</span></div>
<div class="line"><span class="keywordtype">size_t</span> data_len                 = 0;    <span class="comment">// recevied data length</span></div>
<div class="line">uint8_t option                  = 0;    <span class="comment">// received packet option</span></div>
<div class="line">uint8_t payload[PAYLOAD_SIZE]   = {0};  <span class="comment">// data to be sent (4bytes (sizeof(float)=32bits))</span></div>
<div class="line"><span class="keywordtype">int</span> DS18S20_Pin                 = 2;    <span class="comment">// DS18S20 Signal pin on digital 2</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Temperature chip i/o</span></div>
<div class="line">OneWire ds(DS18S20_Pin); <span class="comment">// on digital pin 2</span></div>
<div class="line"></div>
<div class="line">XBee xbee = XBee();</div>
<div class="line">XBeeResponse response = XBeeResponse();</div>
<div class="line">Rx16Response rx16 = Rx16Response();</div>
<div class="line">Rx64Response rx64 = Rx64Response();</div>
<div class="line">Tx16Request tx = Tx16Request(0x0, &amp;payload[0], PAYLOAD_SIZE);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">float</span> getTemp(<span class="keywordtype">bool</span> * success = NULL);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    Serial.begin(9600);</div>
<div class="line">    xbee.setSerial(Serial);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <span class="keywordtype">bool</span> temp_success = <span class="keyword">false</span>;</div>
<div class="line">    xbee.readPacket();</div>
<div class="line">    <span class="keywordflow">if</span> (xbee.getResponse().isAvailable()) {</div>
<div class="line">        <span class="keywordflow">if</span> (xbee.getResponse().getApiId() == RX_16_RESPONSE || xbee.getResponse().getApiId() == RX_64_RESPONSE) {</div>
<div class="line">            <span class="keywordflow">if</span> (xbee.getResponse().getApiId() == RX_16_RESPONSE) {</div>
<div class="line">                xbee.getResponse().getRx16Response(rx16);</div>
<div class="line">                option = rx16.getOption();</div>
<div class="line">                data = rx16.getData();</div>
<div class="line">                data_len = rx16.getDataLength();</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                xbee.getResponse().getRx64Response(rx64);</div>
<div class="line">                option = rx64.getOption();</div>
<div class="line">                data = rx64.getData();</div>
<div class="line">                data_len = rx64.getDataLength();</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span>(NULL != data) {</div>
<div class="line">                Serial.println(<span class="stringliteral">&quot;Received&quot;</span>);</div>
<div class="line">                Serial.write(data, data_len);</div>
<div class="line">                Serial.println(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">                <span class="keywordflow">if</span>(strcmp((<span class="keywordtype">char</span>*)data, <span class="stringliteral">&quot;temp&quot;</span>) == 0) {</div>
<div class="line">                    Serial.println(<span class="stringliteral">&quot;Temp request&quot;</span>);</div>
<div class="line">                    <span class="keywordtype">float</span> temp = getTemp(&amp;temp_success);</div>
<div class="line">                    <span class="keywordflow">if</span>(!temp_success) {</div>
<div class="line">                        Serial.println(<span class="stringliteral">&quot;Failed to get temperature !!!&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">return</span>;</div>
<div class="line">                    }</div>
<div class="line">                    Serial.print(<span class="stringliteral">&quot;Temp: &quot;</span>);</div>
<div class="line">                    Serial.print(temp, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line">                    Serial.println(<span class="stringliteral">&quot;°C&quot;</span>);</div>
<div class="line">                    float_sensor_result res;</div>
<div class="line">                    res.float_variable = temp;</div>
<div class="line">                    memcpy(&amp;payload, &amp;res.bytes_array[0], PAYLOAD_SIZE);</div>
<div class="line"></div>
<div class="line">                    xbee.send(tx);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                Serial.println(<span class="stringliteral">&quot;Failed to get data&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">//Serial.println(&quot;Ignoring received packet&quot;);</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">//Serial.println(&quot;No data&quot;);</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//returns the temperature from one DS18S20 in DEG Celsius</span></div>
<div class="line"><span class="keywordtype">float</span> getTemp(<span class="keywordtype">bool</span> * success) {</div>
<div class="line">    <span class="keywordtype">bool</span> l_success = <span class="keyword">false</span>;</div>
<div class="line">    byte l_data[12] = {0};</div>
<div class="line">    byte l_addr[8] = {0};</div>
<div class="line">    byte l_msb = 0;</div>
<div class="line">    byte l_lsb = 0;</div>
<div class="line">    <span class="keywordtype">float</span> temperature = 0.0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( !ds.search(l_addr)) {</div>
<div class="line">        <span class="comment">//no more sensors on chain, reset search</span></div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;No sensor found!&quot;</span>);</div>
<div class="line">        ds.reset_search();</div>
<div class="line">        <span class="keywordflow">goto</span> exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( OneWire::crc8( l_addr, 7) != l_addr[7]) {</div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;CRC is not valid!&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( l_addr[0] != 0x10 &amp;&amp; l_addr[0] != 0x28) {</div>
<div class="line">        Serial.print(<span class="stringliteral">&quot;Device is not recognized&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> exit;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ds.reset();</div>
<div class="line">    ds.select(l_addr);</div>
<div class="line">    ds.write(0x44,1); <span class="comment">// start conversion, with parasite power on at the end</span></div>
<div class="line"></div>
<div class="line">    ds.reset();</div>
<div class="line">    ds.select(l_addr);</div>
<div class="line">    ds.write(0xBE); <span class="comment">// Read Scratchpad</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 9; i++) { <span class="comment">// we need 9 bytes</span></div>
<div class="line">        l_data[i] = ds.read();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ds.reset_search();</div>
<div class="line"></div>
<div class="line">    l_msb = l_data[1];</div>
<div class="line">    l_lsb = l_data[0];</div>
<div class="line">    temperature = ((l_msb &lt;&lt; 8) | l_lsb); <span class="comment">//using two&#39;s compliment</span></div>
<div class="line">    temperature /= 16;</div>
<div class="line">    </div>
<div class="line">    l_success = <span class="keyword">true</span>;</div>
<div class="line">    </div>
<div class="line"></div>
<div class="line">exit:</div>
<div class="line">    <span class="keywordflow">if</span>(NULL != success) {</div>
<div class="line">        *success = l_success;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> temperature;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 13 2015 19:02:02 for QtXBee by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
